<!DOCTYPE html>
<html>
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-10207332-28"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-10207332-28');
  </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TheBetterRobot</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="assets/css/styles.css" type="text/css">
</head>
<body>
    <div id="fb-root"></div>
    <script>
        window.fbAsyncInit = function() {
            FB.init({
            appId      : '369191820286664',
            cookie     : true,
            xfbml      : true,
            version    : 'v3.1'
            });
            
            // FB.AppEvents.logPageView();   

            FB.getLoginStatus(function(response) {
                statusChangeCallback(response);
            });
            
        };
        
        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.1&appId=369191820286664&autoLogAppEvents=1";
            fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
        
        function statusChangeCallback(response) {
          console.log(response);

          // check if user is in db
          // if true respond with name, friends, stage in challenge
          // if false get name and friends and add to db
          /*
            response = {
              status: 'connected',
              authResponse: {
                  accessToken: '...',
                  expiresIn:'...',
                  signedRequest:'...',
                  userID:'...'
              }
            }
          */
            if (response.status === 'connected') {
                console.log('Logged in & authenticated');
                console.log(response);
                let currentUserId = response.authResponse.userID;
                let currentUserAccessToken = response.authResponse.accessToken;
                // make call to friends and get user data
                // place user data in db
                // display user game status
            } if (response.status === 'authorization_expired') {
                console.log('logged in previously but app authorization to access data expired');
                console.log(response);
                // ask user to reauthorize app to participate
                // ask user if they want to see their game status
            } if (response.status === 'not_authorized') {
                console.log('logged into fb but no app authorization to access data');
                console.log(response);
                // invite user to participate in challenge
            } if (response.status === 'unknown') {
                console.log("user is either not logged into Facebook or explicitly logged out of your application so it doesn't attempt to connect to Facebook and thus, we don't know if they've authenticated your application or not.");
                console.log(response);
                // invite user to login to fb and participate in challenge
            } else {
                console.log("not unknown but not known why");
                console.log(response);
                // invite user to login to fb and participate in challenge
            }
        }

        function checkLoginState() {
        FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
        });
        }

    </script>
    <!-- Load Facebook SDK for JavaScript -->
    
    <script>(function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/en_US/sdk/xfbml.customerchat.js#xfbml=1&version=v2.12&autoLogAppEvents=1';
        fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
        window.extAsyncInit = function() {
        // the Messenger Extensions JS SDK is done loading
        console.log("the Messenger Extensions JS SDK is done loading");
        };
    </script>
    <!-- Load Facebook SDK for JavaScript -->
    <!-- <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = 'https://connect.facebook.net/en_US/sdk/xfbml.customerchat.js#xfbml=1&version=v2.12&autoLogAppEvents=1';
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script> -->

    <!-- Your customer chat code -->
    <div class="fb-customerchat"
      attribution=setup_tool
      page_id="249017771961496"
      theme_color="#000000"
      logged_in_greeting="What's up? I'm TheBetterRobot."
      logged_out_greeting="Pleasure meeting you.">
    </div>

  <section class="hero">
    <div class="background-image" style="background-image: url(assets/img/main.jpg);"></div>
    <div class="hero-content-area">
      <h1>TheBetterRobot</h1>
      <h3>Share To Change Your World</h3>
        <fb:login-button
            class="fb-login-button"
            data-max-rows="1" data-size="large"
            data-button-type="continue_with"
            data-show-faces="true"
            data-auto-logout-link="false"
            data-use-continue-as="true" 
            scope="public_profile, email, first_name, last_name"
            onlogin="checkLoginState();">
        </fb:login-button>
    </div>
  </section>
</body>
</html>
